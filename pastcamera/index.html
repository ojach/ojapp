<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PastCamera</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<!-- ICONS -->
<link rel="icon" type="image/png" sizes="16x16" href="/icon/favicon-16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/icon/favicon-32.png">
<link rel="icon" type="image/png" sizes="48x48" href="/icon/favicon-48.png">
<link rel="apple-touch-icon" sizes="180x180" href="/icon/icon-180.png">

<meta name="theme-color" content="#2bb7ff">

<!-- DARKMODE -->
<script src="/darkmode.js" defer></script>
<style>

:root {
  --bg: #ffffff;
  --text: #222;
  --header-border: #eee;

  --section-bg: #ffffff;
  --section-shadow: rgba(0, 0, 0, .05);

  --input-bg: #ffffff;
  --input-border: #ddd;

  --icon-bg: #f5f5f5;

  --assistant-bg: #ffffff;
  --assistant-border: #2bb7ff;

   --sub: #9a9aa0;
  --accent: #F3F4F6;
  --an: #222;
}

/* ===== Dark Mode ===== */
.dark {
  --bg: #111;
  --text: #eaeaea;
  --header-border: #444;

  --section-bg: #1a1a1a;
  --section-shadow: rgba(0, 0, 0, .4);

  --input-bg: #222;
  --input-border: #555;

  --icon-bg: #2a2a2a;

  --assistant-bg: #111;
  --assistant-border: #67c8ff;

  --accent: #1a1a1f;
  --an: #ffffff;
}


/* =========================================
   Base
========================================= */
html, body {
  margin: 0;
  width: 100%;
  max-width: 100%;
  overflow-x: hidden;
  font-family: "Helvetica","Arial","YuGothic",sans-serif;
  background: var(--bg);
  color: var(--text);
  box-sizing: border-box;
}

*, *:before, *:after {
  box-sizing: inherit;
}

.center {
  width: 100%;
  max-width: 500px;
  margin: 0 auto;
  text-align: center;
}

.header {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 58px;
  padding: 0 16px;
  border-bottom: 1px solid var(--header-border);
}

.logo-link {
  display: flex;
  align-items: center;
  gap: 6px;
  text-decoration: none;
  color: inherit;
}

.logo-img {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  object-fit: cover;
}

.logo-text {
  font-size: 22px;
  font-weight: bold;
  line-height: 1;
  position: relative;
  top: 1px;
}

.switch {
  font-size: 24px;
  cursor: pointer;
}

main {
  width: 100%;
  max-width: 420px;
  padding: 28px 20px 40px;
}

/* ===== Header ===== */
main h1 {
  font-size: 26px;
  margin: 0;
  letter-spacing: 0.04em;
}

main p {
  margin: 6px 0 28px;
  font-size: 13px;
  color: var(--txet);
}

/* ===== Upload ===== */
.upload {
  background: var(--accent);
  border-radius: 16px;
  padding: 24px;
  text-align: center;
  cursor: pointer;
}

.upload input {
  display: none;
}

.upload span {
  font-size: 14px;
  color: var(--txet);
}

/* ===== Era Select ===== */
.eras {
  display: grid;
  gap: 12px;
  margin: 28px 0;
}

.era {
  background: var(--accent);
  border-radius: 14px;
  padding: 16px;
  cursor: pointer;
  border: 1px solid transparent;
}

.era.active {
  border-color: var(--sub);
}

.era strong {
  font-size: 15px;
}

.era small {
  display: block;
  margin-top: 4px;
  font-size: 12px;
  color: var(--sub);
}

/* ===== Save ===== */
button {
  width: 100%;
  padding: 16px;
  border-radius: 999px;
  border: none;
  background: var(--an);
  color: var(--bg);
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
}

/* ===== Result ===== */
.result {
  margin-top: 20px;
  font-size: 13px;
  color: var(--text);
  text-align: center;
}
  .previewImage {
  max-width: 100%;
  border-radius: 12px;
  margin-top: 20px;
}
/* =========================================
   Breadcrumbï¼ˆãƒ‘ãƒ³ããšï¼‰
========================================= */
.breadcrumb {
  font-size: 14px;
  margin: 6px 0 14px;
  color: var(--text);
  opacity: 0.7;
  text-align: left;
  max-width:500px;
  margin-left: auto;
  margin-right: auto;
}

.breadcrumb a {
  color: var(--assistant-border);
  font-weight: bold;
  text-decoration: none;
}

.breadcrumb a:hover {
  text-decoration: underline;
}
</style>
</head>

<body>
  <header class="header">
  <a href="/" class="logo-link">
    <img src="/icon/ojapp-logo.png?v=4" class="logo-img" alt="OJapp">
    <span class="logo-text">OJapp</span>
  </a>
  <div class="switch" onclick="toggleTheme()">ğŸ¤©</div>
</header>
<main>
 <nav class="breadcrumb">
    <a href="/">OJapp</a> â€ºÂ 
    <span>pastcamera</span>
  </nav>

  <h1>PastCamera</h1>
  <p>å†™çœŸã‚’ã€éå»ã®ã‚µã‚¤ã‚ºã«ã€‚</p>


<label class="upload">
  <input type="file" id="photoInput" accept="image/*">
  <span>å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</span>
</label>
<div id="fileName"></div>
<section class="eras">
  <div class="era active">
    <strong>1998ï½œãƒ•ã‚£ãƒ«ãƒ </strong>
    <small>å†™ã£ã¦ã‚‹ã ã‘ã§å¬‰ã—ã„</small>
  </div>
  <div class="era">
    <strong>2010ï½œãƒ‡ã‚¸ã‚«ãƒ¡</strong>
    <small>ã¡ã‚ƒã‚“ã¨æ’®ã£ãŸæ€ã„å‡º</small>
  </div>
  <div class="era">
    <strong>2014ï½œåˆæœŸã‚¹ãƒãƒ›</strong>
    <small>ã¡ã‚‡ã£ã¨å‰ãªã®ã«ã€ã‚‚ã†æ‡ã‹ã—ã„</small>
  </div>
</section>

<button>ç”»åƒã‚’ä¿å­˜</button>

<div class="result">
  1998å¹´ã®å†™çœŸã§ã™ï¼ˆ82KBï¼‰
</div>
<img id="output" class="previewImage">

</main>
  <script>
let selectedPreset = "film1998";
let originalImage = null;

/* ===== å¹´ä»£ãƒ—ãƒªã‚»ãƒƒãƒˆ ===== */
const PRESETS = {
  film1998: {
    label: "1998ï½œãƒ•ã‚£ãƒ«ãƒ ",
    maxSize: 720,
    quality: 0.55,
    noise: 0.14,
    blur: 0.5,
    message: "å†™ã£ã¦ã‚‹ã ã‘ã§å¬‰ã—ã„"
  },
  digi2010: {
    label: "2010ï½œãƒ‡ã‚¸ã‚«ãƒ¡",
    maxSize: 1024,
    quality: 0.6,
    noise: 0.18,
    blur: 0.2,
    message: "ã¡ã‚ƒã‚“ã¨æ’®ã£ãŸæ€ã„å‡º"
  },
  phone2014: {
    label: "2014ï½œåˆæœŸã‚¹ãƒãƒ›",
    maxSize: 1600,
    quality: 0.7,
    noise: 0.1,
    blur: 0.25,
    message: "ã¡ã‚‡ã£ã¨å‰ãªã®ã«ã€ã‚‚ã†æ‡ã‹ã—ã„"
  }
};

/* ===== DOM ===== */
const fileInput = document.querySelector('input[type="file"]');
const eraEls = document.querySelectorAll(".era");
const saveBtn = document.querySelector("button");
const resultEl = document.querySelector(".result");

    const input = document.getElementById("photoInput");
const nameBox = document.getElementById("fileName");

input.addEventListener("change", () => {
  if (input.files.length > 0) {
    nameBox.textContent = "ğŸ“‚ " + input.files[0].name;
  } else {
    nameBox.textContent = "";
  }
});

/* ===== å¹´ä»£é¸æŠ ===== */
eraEls.forEach((el, i) => {
  el.addEventListener("click", () => {
    eraEls.forEach(e => e.classList.remove("active"));
    el.classList.add("active");
    selectedPreset = Object.keys(PRESETS)[i];
  });
});

/* ===== ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ ===== */
fileInput.addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;

  const img = new Image();
  img.onload = () => {
    originalImage = img;
    resultEl.textContent = "å†™çœŸã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ";
  };
  img.src = URL.createObjectURL(file);
});

/* ===== ä¿å­˜å‡¦ç† ===== */
saveBtn.addEventListener("click", async () => {
  if (!originalImage) {
    alert("å†™çœŸã‚’é¸ã‚“ã§ãã ã•ã„");
    return;
  }

  const p = PRESETS[selectedPreset];
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  /* ãƒªã‚µã‚¤ã‚º */
  const scale = Math.min(
    p.maxSize / originalImage.width,
    p.maxSize / originalImage.height,
    1
  );
  canvas.width = originalImage.width * scale;
  canvas.height = originalImage.height * scale;

  ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);

  /* ã¼ã‹ã— */
  if (p.blur > 0) {
    ctx.filter = `blur(${p.blur}px)`;
    ctx.drawImage(canvas, 0, 0);
    ctx.filter = "none";
  }

  /* ãƒã‚¤ã‚º */
const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  const d = imgData.data;
  for (let i = 0; i < d.length; i += 4) {
    const r = d[i], g = d[i+1], b = d[i+2];
    const luma = r*0.3 + g*0.59 + b*0.11;
    const shadow = Math.max(0, (150 - luma) / 150);
    const n = (Math.random() - 0.5) * 255 * p.noise * shadow;

    const avg = (r + g + b) / 3;
    // å¹´ä»£åˆ¥è¨­å®š
const setting = {
  film1998: { rshift: 5,  bshift: -5,  fade: 0.10, mura: 10 },
  digi2010: { rshift: 1,  bshift: -1,  fade: 0.04, mura: 3  },
  phone2014: { rshift: 1,  bshift: -1,  fade: 0.07, mura: 5  }
}[selectedPreset];

// è‰²è»¢ã³
d[i]     += setting.rshift;
d[i + 2] += setting.bshift;

// é€€è‰²
d[i]     = d[i]     * (1 - setting.fade) + avg * setting.fade;
d[i + 1] = d[i + 1] * (1 - setting.fade) + avg * setting.fade;
d[i + 2] = d[i + 2] * (1 - setting.fade) + avg * setting.fade;

// ãƒ ãƒ©
const m = (Math.random() - 0.5) * setting.mura;
d[i]     += m;
d[i + 1] += m;
d[i + 2] += m;
  }
  ctx.putImageData(imgData, 0, 0);

  /* JPEGæ›¸ãå‡ºã— */
 canvas.toBlob(blob => {
  const sizeKB = Math.round(blob.size / 1024);
  const url = URL.createObjectURL(blob);

  // ğŸ”¥ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒã‚’è¡¨ç¤ºï¼ˆã‚¹ãƒãƒ›ã¯é•·æŠ¼ã—ä¿å­˜OKï¼‰
  document.getElementById("output").src = url;

  // ğŸ”¥ ã“ã“ã¯ä»»æ„ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ï¼ˆå‰Šé™¤ã—ã¦ã‚‚OKï¼‰
  const a = document.createElement("a");
  a.href = url;
  a.download = "pastcamera.jpg";
  a.click();

  // çµæœè¡¨è¨˜
  resultEl.innerHTML = `
    ${p.label} ã®å†™çœŸã§ã™<br>
    ${p.message}ï¼ˆ${sizeKB}KBï¼‰
  `;
}, "image/jpeg", p.quality);
}); // â† â˜… å¿…ãšã“ã“ã§é–‰ã¾ã‚‹ï¼
  </script>
  <!-- FOOTER -->
<div id="footer"></div>
<script>
fetch("/footer.html")
  .then(r => r.text())
  .then(html => document.getElementById("footer").innerHTML = html);
</script>
</body>
</html>
