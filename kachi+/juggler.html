<div class="header">
  <button class="back-btn" onclick="location.href='index.html'">←</button>
  <div class="machine-name" id="machineName">読み込み中…</div>

  <div class="total-games">G数：<span id="totalGames">0</span></div>
</div>
<body>
<div class="games-input">
  総回転数：
  <input type="number" id="inputGames" placeholder="0" oninput="updateGames()">
</div>

<div class="counter-area">

  <!-- ぶどう -->
  <div class="counter-block grape">
    <div class="label">ぶどう</div>
    <button class="count-btn" onclick="addGrape()">+1</button>
    <div class="count-display">
      回数：<span id="grapeCount">0</span><br>
      確率：<span id="grapeRate">1/0</span>
    </div>
  </div>

  <!-- BIG REG -->
  <div class="bonus-row">

    <div class="counter-block big">
      <div class="label">BIG</div>
      <button class="count-btn" onclick="addBig()">+1</button>
      <div class="count-display">回数：<span id="bigCount">0</span></div>
    </div>

    <div class="counter-block reg">
      <div class="label">REG</div>
      <button class="count-btn" onclick="addReg()">+1</button>
      <div class="count-display">回数：<span id="regCount">0</span></div>
    </div>

  </div>

</div>

<div class="result-area">
  <div class="result">BIG：<span id="bigRate">1/0</span></div>
  <div class="result">REG：<span id="regRate">1/0</span></div>
  <div class="result">合算：<span id="totalRate">1/0</span></div>
  <div class="result">ぶどう：<span id="grapeRate2">1/0</span></div>
</div>
</div>
<!-- ▼ 固定フッター（タップで開く） -->
<div id="kachiFooter">▼ 設定推測</div>

<!-- ▼ ボトムシート背景（タップで閉じる） -->
<div id="sheetOverlay"></div>

<!-- ▼ ボトムシート本体 -->
<div id="sheet">
  <div id="sheetHandle"></div>
  <div id="resultTop" class="sheet-top">ここに最も高い設定が出る</div>
  <div id="resultList" class="sheet-list"></div>
  <button id="closeSheet" class="close-btn">閉じる</button>
</div>


  </body>
<script>
// ========================================
// 1. 機種設定マスタ（JSON マスタ）
// ========================================
const machineData = {
  im_juggler: {
    name: "アイムジャグラーEX",
    roles: {
      big:   {1:273, 2:270, 3:269, 4:268, 5:266, 6:255},
      reg:   {1:439, 2:399, 3:331, 4:315, 5:255, 6:255},
      grape: {1:6.02,2:6.02,3:6.02,4:5.78,5:5.78,6:5.66}
    }
  },

  neo_im_juggler: {
    name: "ネオアイムジャグラーEX",
    roles: {
      big:   {1:273.1,2:269.7,3:269.7,4:259,5:259,6:255},
      reg:   {1:439.8,2:399.6,3:331,4:315.1,5:255,6:255},
      grape: {1:6.02,2:6.02,3:6.02,4:5.78,5:5.78,6:5.66}
    }
  },

  funky2: {
    name: "ファンキージャグラー2",
    roles: {
      big:   {1:266.4,2:259.0,3:256.0,4:249.2,5:240.1,6:219.9},
      reg:   {1:439.8,2:407.1,3:366.1,4:322.8,5:299.3,6:262.1},
      grape: {1:5.93,2:5.89,3:5.82,4:5.81,5:5.76,6:5.68}
    }
  },

  myj5: {
    name: "マイジャグラーV",
    roles: {
      big:   {1:272.2,2:270.8,3:266.4,4:259.0,5:255.0,6:255.0},
      reg:   {1:439.8,2:399.6,3:331.0,4:315.1,5:255.0,6:255.0},
      grape: {1:6.03,2:6.03,3:6.00,4:5.94,5:5.90,6:5.85}
    }
  },

  happyv3: {
    name: "ハッピージャグラーVⅢ",
    roles: {
      big:   {1:282.5,2:275.4,3:268.6,4:259.0,5:249.2,6:240.1},
      reg:   {1:431.2,2:390.0,3:336.0,4:315.1,5:292.6,6:273.1},
      grape: {1:6.32,2:6.29,3:6.25,4:6.16,5:6.10,6:6.05}
    }
  },

  gogo3: {
    name: "ゴーゴージャグラー3",
    roles: {
      big:   {1:282.5,2:275.4,3:268.6,4:259.0,5:249.2,6:240.1},
      reg:   {1:431.2,2:390.0,3:336.0,4:315.1,5:292.6,6:273.1},
      grape: {1:6.30,2:6.26,3:6.20,4:6.15,5:6.10,6:6.05}
    }
  },

  girlss: {
    name: "ジャグラーガールズSS",
    roles: {
      big:   {1:273.1,2:270.8,3:269.7,4:259.0,5:255.0,6:255.0},
      reg:   {1:431.2,2:390.0,3:336.0,4:315.1,5:255.0,6:255.0},
      grape: {1:6.10,2:6.05,3:6.00,4:5.95,5:5.90,6:5.85}
    }
  },

  mrj: {
    name: "ミスタージャグラー",
    roles: {
      big:   {1:268.6,2:259.0,3:249.2,4:240.1,5:234.0,6:225.0},
      reg:   {1:431.2,2:390.0,3:336.0,4:315.1,5:292.6,6:273.1},
      grape: {1:6.15,2:6.09,3:6.02,4:5.97,5:5.88,6:5.79}
    }
  },

  umj: {
    name: "ウルトラミラクルジャグラー",
    roles: {
      big:   {1:292.6,2:282.5,3:268.6,4:259.0,5:249.2,6:240.1},
      reg:   {1:431.2,2:390.0,3:336.0,4:315.1,5:292.6,6:273.1},
      grape: {1:6.35,2:6.30,3:6.25,4:6.20,5:6.10,6:6.00}
    }
  }
};

// ========================================
// 2. URLパラメータから機種IDを取得
// ========================================
const id = new URLSearchParams(location.search).get("id");
const machine = machineData[id];

// 機種名の表示
if (machine) {
  document.getElementById("machineName").innerText = machine.name;
} else {
  document.getElementById("machineName").innerText = "機種が見つかりません";
}

// この機種の設定値
let settingValues = machine.roles;

// ========================================
// 3. カウンタ変数
// ========================================
let grape = 0;
let big = 0;
let reg = 0;
let totalGames = 0;

// ========================================
// 4. 総回転数入力
// ========================================
function updateGames() {
  const val = parseInt(document.getElementById("inputGames").value || 0);
  totalGames = val;
  render();
}

// ========================================
// 5. ボタン（+1）
// ========================================
function addGrape() {
  grape++;
  render();
}
function addBig() {
  big++;
  render();
}
function addReg() {
  reg++;
  render();
}

// ========================================
// 6. リセット
// ========================================
function resetAll() {
  grape = 0;
  big = 0;
  reg = 0;
  totalGames = 0;
  document.getElementById("inputGames").value = "";
  render();
}

// ========================================
// 7. 確率計算
// ========================================
function rate(count, games) {
  if (count === 0 || games === 0) return "1/0";
  return "1/" + (games / count).toFixed(2);
}

function totalBonusRate() {
  const t = big + reg;
  if (t === 0 || totalGames === 0) return "1/0";
  return "1/" + (totalGames / t).toFixed(2);
}

// ========================================
// 8. 画面反映
// ========================================
function render() {
  document.getElementById("grapeCount").innerText = grape;
  document.getElementById("bigCount").innerText = big;
  document.getElementById("regCount").innerText = reg;
  document.getElementById("totalGames").innerText = totalGames;

  document.getElementById("grapeRate").innerText = rate(grape, totalGames);
  document.getElementById("grapeRate2").innerText = rate(grape, totalGames);
  document.getElementById("bigRate").innerText = rate(big, totalGames);
  document.getElementById("regRate").innerText = rate(reg, totalGames);
  document.getElementById("totalRate").innerText = totalBonusRate();
}

render();
</script>

